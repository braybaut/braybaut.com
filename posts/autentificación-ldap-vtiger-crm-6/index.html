<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="ie=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="author"
    content="braybaut">
<meta name="description"
    content="Vtiger es un CRM de código abierto muy potente que trata de acercarse a grandes crms como salesforce y SugarCRM, pero en esta ocasión veremos como autentificarlo hacia LDAP.
Con un gran compañero de la compañía Gabo, logramos hacer la autentificación continuación describo los pasos para lograrla.
Para lograr la autentificación debemos usar los archivos de autentificación de Vtiger de 5.x, estos archivos los encuentran en github.
https://github.com/braybaut/ldap-vtiger" />
<meta name="keywords" content="" />
<meta name="robots" content="noodp" />
<link rel="canonical" href="/posts/autentificaci%C3%B3n-ldap-vtiger-crm-6/" />


<title>
    
    Autentificación LDAP Vtiger CRM 6 :: Braybaut 
    
</title>



<link href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:400,700|Source+Code+Pro" rel="stylesheet"
    type="text/css">
<link href="https://cdnjs.cloudflare.com/ajax/libs/flag-icon-css/3.2.1/css/flag-icon.min.css" rel="stylesheet"
    type="text/css">


<link rel="stylesheet" href="/scss/main.min.68f52971e4ebd9aabb93e630af3dc92016c7dcfedd1f0e652a2911deab4e560f.css">



<link rel="stylesheet" type="text/css" href="/css/styles.scss">



<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/site.webmanifest">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#252627">
<link rel="shortcut icon" href="/favicon.ico">
<meta name="theme-color" content="#252627"><meta itemprop="name" content="Autentificación LDAP Vtiger CRM 6">
<meta itemprop="description" content="
Vtiger es un CRM de código abierto muy potente que trata de acercarse  a grandes crms como salesforce y SugarCRM, pero en esta ocasión veremos como autentificarlo hacia LDAP.
Con un gran compañero de la compañía Gabo, logramos hacer la autentificación continuación describo los pasos para lograrla.
Para lograr la autentificación debemos usar los archivos de autentificación de Vtiger de 5.x,  estos archivos los encuentran en github.
https://github.com/braybaut/ldap-vtiger">
<meta itemprop="datePublished" content="2016-01-19T01:43:11+00:00" />
<meta itemprop="dateModified" content="2016-01-19T01:43:11+00:00" />
<meta itemprop="wordCount" content="402">



<meta itemprop="keywords" content="ldap,vtiger," />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Autentificación LDAP Vtiger CRM 6"/>
<meta name="twitter:description" content="
Vtiger es un CRM de código abierto muy potente que trata de acercarse  a grandes crms como salesforce y SugarCRM, pero en esta ocasión veremos como autentificarlo hacia LDAP.
Con un gran compañero de la compañía Gabo, logramos hacer la autentificación continuación describo los pasos para lograrla.
Para lograr la autentificación debemos usar los archivos de autentificación de Vtiger de 5.x,  estos archivos los encuentran en github.
https://github.com/braybaut/ldap-vtiger"/>




<meta property="article:published_time" content="2016-01-19 01:43:11 &#43;0000 &#43;0000" />









    </head>

    <body class="dark-theme">
        <div class="container">
            <header class="header">
    <span class="header__inner">
        <a href="/" style="text-decoration: none;">
    <div class="logo">
        
            <span class="logo__mark">></span>
            <span class="logo__text">$ cd /home/braybaut</span>
            <span class="logo__cursor"></span>
        
    </div>
</a>


        <span class="header__right">
            
                <nav class="menu">
    <ul class="menu__inner"><li><a href="/about">About</a></li><li><a href="/posts">Archive</a></li><li><a href="/archive">Blog</a></li>
    </ul>
</nav>

                <span class="menu-trigger">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                        <path d="M0 0h24v24H0z" fill="none"/>
                        <path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/>
                    </svg>
                </span>
            

            <span class="theme-toggle"><svg class="theme-toggler" width="24" height="24" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
  <path d="M22 41C32.4934 41 41 32.4934 41 22C41 11.5066 32.4934 3 22
  3C11.5066 3 3 11.5066 3 22C3 32.4934 11.5066 41 22 41ZM7 22C7
  13.7157 13.7157 7 22 7V37C13.7157 37 7 30.2843 7 22Z"/>
</svg>
</span>
        </span>
    </span>
</header>


            <div class="content">
                
    <main class="post">
        <div class="post-info">
            
            </p>
        </div>
        
        
        <article>

            <h2 class="post-title"><a href="/posts/autentificaci%C3%B3n-ldap-vtiger-crm-6/">Autentificación LDAP Vtiger CRM 6</a></h2>

            
            <div class="post-content">
                <p><img src="/images/vtiger1.jpg" alt=""></p>
<p>Vtiger es un CRM de código abierto muy potente que trata de acercarse  a grandes crms como salesforce y SugarCRM, pero en esta ocasión veremos como autentificarlo hacia LDAP.</p>
<p>Con un gran compañero de la compañía <a href="https://twitter.com/Gabo_fdc?s=09">Gabo</a>, logramos hacer la autentificación continuación describo los pasos para lograrla.</p>
<p>Para lograr la autentificación debemos usar los archivos de autentificación de Vtiger de 5.x,  estos archivos los encuentran en github.</p>
<p><!-- raw HTML omitted --><a href="https://github.com/braybaut/ldap-vtiger">https://github.com/braybaut/ldap-vtiger</a><!-- raw HTML omitted --></p>
<p>Los archivos Ldap.php y config.ldap.php deben quedar en la siguiente ruta:</p>
<pre><code class="language-code" data-lang="code">/var/www/html/vtigercrm/include/ldap/
</code></pre><p><strong>Nota: debe editar el archivo Config.ldap.php y adicionar la configuración de su servidor LDAP</strong></p>
<p><em>la ruta puede variar dependiendo de donde tenga ubicado los archivos de  vtiger.</em></p>
<p>A continuación debemos hacer unos cambios en el archivo:</p>
<pre><code class="language-code" data-lang="code">/var/www/html/vtigercrm/modules/Users/Users.php
</code></pre><p>Este archivo es el encargado de hacer la autentificación de los usuarios, aquí lo que vamos  hacer es llamar  los archivos <strong>Ldap.php y Config.ldap.php</strong> para que lea las variables y posteriormente lograr la autentificación, igualmente haremos un cambio en una función para que no se presenten problemas.</p>
<p>Adicionar las siguientes dos lineas al final de los require once , aproximadamente en la linea 41:</p>
<div class="highlight"><pre style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-php" data-lang="php">require_once &#39;include/ldap/config.ldap.php&#39;;
require_once &#39;include/ldap/ldap.php&#39;;
</code></pre></div><p>La función dologin la cual es:</p>
<div class="highlight"><pre style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-php" data-lang="php">function doLogin($user_password) {
        global $AUTHCFG;
        $usr_name = $this-&amp;gt;column_fields[&#34;user_name&#34;];

        switch (strtoupper($AUTHCFG[&#39;authType&#39;])) {
            case &#39;LDAP&#39;:
                $this-&amp;gt;log-&amp;gt;debug(&#34;Using LDAP authentication&#34;);
                require_once(&#39;modules/Users/authTypes/LDAP.php&#39;);
                $result = ldapAuthenticate($this-&amp;gt;column_fields[&#34;user_name&#34;], $user_password);
                if ($result == NULL) {
                    return false;
                } else {
                    return true;
                }
                break;

</code></pre></div><p>Debe ser cambiada por esta:</p>
<div class="highlight"><pre style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-php" data-lang="php">function doLogin($user_password) {
        global $AUTHCFG;
        $usr_name = $this-&amp;gt;column_fields[&#34;user_name&#34;];

        // Allow the &#39;admin&#39; always to log in independent from the LDAP server
        $usr_list = $AUTHCFG[&#39;sql_accounts&#39;];

        if (in_array(strtolower($usr_name), $usr_list))
            $AUTHCFG[&#39;authType&#39;] = &#39;SQL&#39;;

        //SEAN TSANG PATCH START - User must exists in database first
        $query = &#34;SELECT * from $this-&amp;gt;table_name where user_name=?&#34;;
               $result = $this-&amp;gt;db-&amp;gt;requirePsSingleResult($query, array($usr_name), false);
              if (empty($result)) return false;
        //SEAN TSANG PATCH END------------------------------------------

        switch (strtoupper($AUTHCFG[&#39;authType&#39;])) {
            case &#39;LDAP&#39;:
                $this-&amp;gt;log-&amp;gt;debug(&#34;Using LDAP authentication&#34;);
                require_once(&#39;include/ldap/Ldap.php&#39;);
                return ldapAuthenticate($this-&amp;gt;column_fields[&#34;user_name&#34;], $user_password);

</code></pre></div><p>Después de estos cambios la autentificación desde LDAP debe funcionar.</p>
<p>Importante:</p>
<p>Automáticamente el no autentificara con los usuarios que esten el el servidor LDAP, Para que funcione debe crear los usuarios en vtiger con  usuario, contraseña, correo electrónico, etc  <strong>(NO IMPORTA LA CONTRASEÑA QUE ASIGNE AL CREAR LA CUENTA,  AL AUTENTIFICARSE CON UN USUARIO, VTIGER BUSCARA LA CONTRASEÑA EN EL SERVIDOR LDAP Y NO USARA LA QUE USTED ASIGNO, EL USERNAME DEL USUARIO DE VTIGER DEBE SER EL MISMO USERNAME DEL USUARIO EN LDAP)</strong></p>
<p>PD: Funciona para todas las versiones de 6.X tanto para 6.0 como para 6.4</p>

            </div>

        </article>

        <hr />

        <div class="post-info">
  				<p>
  					<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-tag meta-icon"><path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"></path><line x1="7" y1="7" x2="7" y2="7"></line></svg><span class="tag"><a href="/tags/ldap">ldap</a></span><span class="tag"><a href="/tags/vtiger">vtiger</a></span>
  				</p>
  			</div>


                    <div id="comments" class="thin">
    <div id="disqus_thread"></div>
<script type="application/javascript">
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "braybaut" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
</div>
    </main>

            </div>

            
                


<footer class="footer">
    <div class="footer__inner">
        <div class="footer__content">
            <span>&copy; 2020</span>
            
                <span><a href="">Braybaut</a></span>
            
            <span></span>
            <span> <a href="posts/index.xml" target="_blank" title="rss"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 20 20" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-rss"><path d="M4 11a9 9 0 0 1 9 9"></path><path d="M4 4a16 16 0 0 1 16 16"></path><circle cx="5" cy="19" r="1"></circle></svg></a></span>
        </div>
    </div>
    <div class="footer__inner">
        <div class="footer__content">

        </div>
    </div>
    <div class="footer__inner">
        <div class="footer__content">
            <span>Powered by <a href="http://gohugo.io">Hugo</a></span>
        </div>
    </div>
</footer>

            
        </div>

        




<script type="text/javascript" src="/js/bundle.7c1b69a274216adf96a8777b43114bf0d163ca44637d7b5acd3d29f1a71c64ae72f42ae83247967d11a3a5ee6fb7f501c1350e1e5931a23902f24da1c8bdf719.js" integrity="sha512-fBtponQhat&#43;WqHd7QxFL8NFjykRjfXtazT0p8accZK5y9CroMkeWfRGjpe5vt/UBwTUOHlkxojkC8k2hyL33GQ=="></script>
    <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
        ga('create', 'UA-69725711-1', 'auto');
        ga('send', 'pageview');
    </script>



    </body>
</html>
